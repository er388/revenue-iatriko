# CONTEXT
You are implementing 3 advanced features for a Greek medical revenue management system:
- Forecasting tab (revenue predictions)
- Heatmaps tab (visual data analysis)
- Cloud Storage tab (cloud sync)

The app is a modular ES6 JavaScript application with:
- IndexedDB storage
- Chart.js for visualizations
- Modular architecture (state.js, storage.js, dataManager.js, etc.)
- Greek UI language
- Dark mode support

# EXISTING ARCHITECTURE
- **state.js**: Global state management
- **storage.js**: IndexedDB wrapper
- **dataManager.js**: CRUD operations
- **uiRenderers.js**: UI rendering functions
- **eopyyClawback.js**: ΕΟΠΥΥ deductions logic
- **reports.js**: Report generation
- **comparison.js**: Period comparison (already exists)
- **formHandlers.js**: Form validation & handlers
- **eventHandlers.js**: Event management
- **filters.js**: Data filtering
- **pdfExport.js**: PDF generation
- **backup.js**: Import/export

# TASK 1: FORECASTING MODULE

## Requirements:
1. **File**: `forecasting.js` (new module)
2. **Methods to implement**:
   - Linear Regression
   - Seasonal Naive
   - Holt-Winters Exponential Smoothing
3. **Features**:
   - Historical data visualization
   - 3-6 month forecasts
   - Confidence intervals (95%)
   - Accuracy metrics (MAE, RMSE, MAPE)
   - Interactive Chart.js graphs
   - Export forecasts to CSV/PDF

## Implementation Details:
```javascript
// forecasting.js structure
class ForecastingManager {
    constructor() {
        this.models = ['linear', 'seasonal', 'holt-winters'];
    }
    
    // Methods:
    linearRegression(data, periods)
    seasonalNaive(data, periods)
    holtWinters(data, periods, alpha, beta, gamma)
    calculateMetrics(actual, predicted)
    generateForecast(entries, method, periods)
    visualizeForecast(historical, forecast, confidence)
}
```

## UI Requirements:
- Model selector dropdown
- Forecast period slider (3-12 months)
- Historical vs Predicted chart
- Metrics display (accuracy table)
- Export buttons (CSV, PDF)
- Loading indicators

---

# TASK 2: HEATMAPS MODULE

## Requirements:
1. **File**: `heatmaps.js` (new module)
2. **Heatmap Types**:
   - Month × Year heatmap
   - Source × Month heatmap
   - Insurance × Month heatmap
3. **Features**:
   - Canvas-based rendering (or Chart.js matrix)
   - Color gradient scales (green → yellow → red)
   - Hover tooltips with exact values
   - Export to PNG/PDF
   - Interactive zoom/pan

## Implementation Details:
```javascript
// heatmaps.js structure
class HeatmapManager {
    constructor() {
        this.colorSchemes = {
            revenue: ['#10b981', '#f59e0b', '#ef4444'],
            deductions: ['#3b82f6', '#8b5cf6', '#ec4899']
        };
    }
    
    // Methods:
    generateMonthYearHeatmap(entries)
    generateSourceMonthHeatmap(entries)
    generateInsuranceMonthHeatmap(entries)
    renderCanvas(data, type)
    exportHeatmapPNG(canvasId)
    calculateColorScale(values)
}
```

## UI Requirements:
- Heatmap type selector
- Canvas container with tooltips
- Color scale legend
- Export buttons (PNG, PDF)
- Responsive grid layout

---

# TASK 3: CLOUD STORAGE MODULE

## Requirements:
1. **File**: `cloudAdapters.js` (new module)
2. **Supported Providers**:
   - Google Drive (OAuth2 PKCE)
   - Dropbox (OAuth2 PKCE)
   - OneDrive (OAuth2 PKCE)
3. **Features**:
   - Auto-sync (configurable intervals: 5min, 15min, 1hr, manual)
   - Conflict resolution strategies:
     - Last-write-wins
     - Manual merge UI
   - Sync status indicator
   - Connection management

## Implementation Details:
```javascript
// cloudAdapters.js structure
class CloudSyncManager {
    constructor() {
        this.providers = {
            gdrive: new GoogleDriveAdapter(),
            dropbox: new DropboxAdapter(),
            onedrive: new OneDriveAdapter()
        };
        this.syncInterval = null;
    }
    
    // Methods:
    authenticate(provider)
    sync(provider, strategy)
    uploadBackup(provider, data)
    downloadBackup(provider)
    resolveConflicts(local, remote, strategy)
    startAutoSync(interval)
    stopAutoSync()
}

class GoogleDriveAdapter {
    async authenticate() { /* OAuth2 PKCE flow */ }
    async upload(data) { /* Upload to Drive */ }
    async download() { /* Download from Drive */ }
}

// Similar for Dropbox, OneDrive
```

## UI Requirements:
- Provider selection (radio buttons)
- Connect/Disconnect buttons
- Sync status badge (✅ synced, ⏳ syncing, ❌ error)
- Auto-sync toggle + interval selector
- Last sync timestamp
- Manual sync button
- Conflict resolution modal

---

# INTEGRATION REQUIREMENTS

## Update Existing Files:

### 1. **index.html** - Add views:
```html
<!-- Forecasting View -->
<div id="forecastingView" class="view">
    <div class="view-header">...</div>
    <div class="card">
        <!-- Model selector, chart, metrics -->
    </div>
</div>

<!-- Heatmaps View -->
<div id="heatmapsView" class="view">
    <div class="view-header">...</div>
    <div class="card">
        <!-- Heatmap type selector, canvas, legend -->
    </div>
</div>

<!-- Cloud View -->
<div id="cloudView" class="view">
    <div class="view-header">...</div>
    <div class="card">
        <!-- Provider selection, sync controls -->
    </div>
</div>
```

### 2. **app.js** - Import & initialize:
```javascript
import forecastingManager from './forecasting.js';
import heatmapManager from './heatmaps.js';
import cloudSyncManager from './cloudAdapters.js';

// Setup event listeners
setupForecastingView();
setupHeatmapsView();
setupCloudView();
```

### 3. **styles.css** - Add styles:
```css
/* Forecasting styles */
.forecast-chart { ... }
.metrics-grid { ... }

/* Heatmap styles */
.heatmap-canvas { ... }
.color-legend { ... }

/* Cloud sync styles */
.provider-card { ... }
.sync-status { ... }
```

---

# TECHNICAL CONSTRAINTS

1. **No External ML Libraries**: Implement forecasting algorithms from scratch using vanilla JS
2. **OAuth2 PKCE**: Use standard OAuth2 PKCE flow (no server-side tokens)
3. **Canvas or Chart.js**: For heatmaps, use native Canvas API or Chart.js matrix
4. **No localStorage**: Use existing IndexedDB wrapper (`storage.js`)
5. **Greek Language**: All UI text in Greek
6. **Dark Mode**: Support existing dark theme
7. **Mobile Responsive**: All views must work on mobile
8. **Error Handling**: Comprehensive try-catch with user-friendly toasts

---

# DELIVERABLES

Please create:

1. **forecasting.js** - Full forecasting module with 3 methods + visualization
2. **heatmaps.js** - Heatmap generator with 3 types + export
3. **cloudAdapters.js** - Cloud sync with 3 providers + OAuth2
4. **HTML snippets** - For the 3 new views
5. **CSS additions** - Styles for new components
6. **app.js updates** - Integration code

---

# IMPLEMENTATION PRIORITY

1. **Phase 1**: Forecasting (most complex ML logic)
2. **Phase 2**: Heatmaps (visual + Canvas work)
3. **Phase 3**: Cloud Storage (OAuth2 + sync logic)

---

# QUALITY REQUIREMENTS

- ✅ Code must follow existing architecture patterns
- ✅ Use existing utility functions (formatCurrency, escapeHtml, etc.)
- ✅ Comprehensive error handling
- ✅ Loading indicators for async operations
- ✅ Toast notifications for user feedback
- ✅ JSDoc comments for all functions
- ✅ Console logs for debugging
- ✅ Mobile-first responsive design

---

# EXAMPLE USAGE
```javascript
// Forecasting
const forecast = await forecastingManager.generateForecast(
    STATE.entries, 
    'holt-winters', 
    6
);
forecastingManager.visualizeForecast(forecast);

// Heatmaps
const heatmapData = heatmapManager.generateMonthYearHeatmap(STATE.entries);
heatmapManager.renderCanvas(heatmapData, 'month-year');

// Cloud Sync
await cloudSyncManager.authenticate('gdrive');
await cloudSyncManager.sync('gdrive', 'last-write-wins');
cloudSyncManager.startAutoSync(15); // 15 minutes
```

---

# START WITH FORECASTING MODULE

Generate the complete `forecasting.js` module first, following the architecture above.