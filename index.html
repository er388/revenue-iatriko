<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Διαχείριση Εσόδων</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <h1>Διαχείριση Εσόδων</h1>
            <div class="header-actions">
                <span id="userLabel" class="user-label">Χρήστης: Admin</span>
                <span id="autosaveIndicator" class="autosave-indicator" style="display: none;">Αποθηκεύτηκε</span>
                <button id="backupBtn" class="btn-secondary btn-compact">💾 Backup</button>
            </div>
        </div>
    </header>

    <nav class="nav-tabs">
        <div class="container">
            <button class="nav-tab active" data-view="dashboard">📊 Dashboard</button>
            <button class="nav-tab" data-view="entries">📋 Εγγραφές</button>
            <button class="nav-tab" data-view="reports">📈 Αναφορές</button>
            <button class="nav-tab" data-view="comparison">🔄 Σύγκριση</button>
            <button class="nav-tab" data-view="forecasting">🔮 Προβλέψεις</button>
            <button class="nav-tab" data-view="heatmaps">🌡️ Heatmaps</button>
            <button class="nav-tab" data-view="cloud">☁️ Cloud</button>
            <button class="nav-tab" data-view="settings">⚙️ Ρυθμίσεις</button>
        </div>
    </nav>

    <main class="container main-content">
        
        <!-- Dashboard View -->
        <div id="dashboardView" class="view active">
            <div class="dashboard-header">
                <h2>Επισκόπηση</h2>
                <div class="quick-filters">
                    <select id="dashPeriod" class="form-select form-compact">
                        <option value="month" selected>Μήνας</option>
                        <option value="year">Έτος</option>
                        <option value="all">Όλα</option>
                    </select>
                    <label class="checkbox-label">
                        <input type="checkbox" id="dashIncludeParakratisi" checked>
                        <span>Με Παρακράτηση</span>
                    </label>
                </div>
            </div>

            <!-- Quick Add Form -->
            <div class="card card-compact">
                <h3>Γρήγορη Καταχώριση</h3>
                <form id="quickAddForm">
                    <div class="form-row">
                        <div class="form-group form-group-compact">
                            <label>Ημερομηνία (ΜΜ/ΕΕΕΕ)*</label>
                            <input type="text" id="quickDate" class="form-input form-input-compact" placeholder="01/2025" required>
                        </div>
                        <div class="form-group form-group-compact">
                            <label>Διαγνωστικό*</label>
                            <select id="quickSource" class="form-select form-select-compact" required>
                                <option value="">Επιλογή...</option>
                            </select>
                        </div>
                        <div class="form-group form-group-compact">
                            <label>Ασφάλεια*</label>
                            <select id="quickInsurance" class="form-select form-select-compact" required>
                                <option value="">Επιλογή...</option>
                            </select>
                        </div>
                        <div class="form-group form-group-compact">
                            <label>Τύπος*</label>
                            <select id="quickType" class="form-select form-select-compact" required>
                                <option value="cash">Μετρητά</option>
                                <option value="invoice">Τιμολόγια</option>
                            </select>
                        </div>
                        <div class="form-group form-group-compact">
                            <label>Ποσό (€)*</label>
                            <input type="number" id="quickAmount" class="form-input form-input-compact" step="0.01" min="0" required>
                        </div>
                    </div>
                    
                    <!-- ΕΟΠΥΥ Deductions -->
                    <div id="quickEopyyDeductions" class="retention-fields retention-compact" style="display: none;">
                        <h4>Κρατήσεις ΕΟΠΥΥ</h4>
                        <div class="form-row form-row-tight">
                            <div class="form-group form-group-compact">
                                <label>Παρακράτηση €</label>
                                <input type="number" id="quickParakratisi" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                            </div>
                            <div class="form-group form-group-compact">
                                <label>Παρακράτηση %</label>
                                <input type="number" id="quickParakratisiPercent" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                            </div>
                            <div class="form-group form-group-compact">
                                <label>ΜΔΕ €</label>
                                <input type="number" id="quickMDE" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                            </div>
                            <div class="form-group form-group-compact">
                                <label>ΜΔΕ %</label>
                                <input type="number" id="quickMDEPercent" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                            </div>
                        </div>
                        <div class="form-row form-row-tight">
                            <div class="form-group form-group-compact">
                                <label>Rebate €</label>
                                <input type="number" id="quickRebate" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                            </div>
                            <div class="form-group form-group-compact">
                                <label>Rebate %</label>
                                <input type="number" id="quickRebatePercent" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                            </div>
                            <div class="form-group form-group-compact">
                                <label>Κρατήσεις €</label>
                                <input type="number" id="quickKrathseisEopyy" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                            </div>
                            <div class="form-group form-group-compact">
                                <label>Κρατήσεις %</label>
                                <input type="number" id="quickKrathseisEopyyPercent" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                            </div>
                        </div>
                        <div class="form-row form-row-tight">
                            <div class="form-group form-group-compact">
                                <label>Clawback €</label>
                                <input type="number" id="quickClawback" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                            </div>
                            <div class="form-group form-group-compact">
                                <label>Clawback %</label>
                                <input type="number" id="quickClawbackPercent" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                            </div>
                        </div>
                    </div>

                    <!-- Non-ΕΟΠΥΥ Deductions -->
                    <div id="quickNonEopyyDeductions" class="retention-fields retention-compact" style="display: none;">
                        <h4>Κρατήσεις</h4>
                        <div class="form-row form-row-tight">
                            <div class="form-group form-group-compact">
                                <label>Κρατήσεις €</label>
                                <input type="number" id="quickKrathseisOther" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                            </div>
                            <div class="form-group form-group-compact">
                                <label>Κρατήσεις %</label>
                                <input type="number" id="quickKrathseisOtherPercent" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                            </div>
                        </div>
                    </div>

                    <!-- Final Amount Display -->
                    <div class="final-amount-display">
                        <strong>Τελικό Ποσό: <span id="quickFinalAmount">€ 0,00</span></strong>
                    </div>

                    <div class="form-group form-group-compact">
                        <label class="checkbox-label">
                            <input type="checkbox" id="quickNotesToggle">
                            <span>Προσθήκη Σημειώσεων</span>
                        </label>
                        <textarea id="quickNotes" class="form-textarea form-textarea-compact" rows="2" style="display: none;"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-primary btn-compact">Καταχώριση</button>
                    </div>
                </form>
            </div>

            <!-- KPI Cards -->
            <div class="kpi-grid kpi-grid-compact">
                <div class="kpi-card kpi-card-compact" id="kpiTotal"></div>
                <div class="kpi-card kpi-card-compact" id="kpiEopyy"></div>
                <div class="kpi-card kpi-card-compact" id="kpiOthers"></div>
                <div class="kpi-card kpi-card-compact" id="kpiDeductions"></div>
                <div class="kpi-card kpi-card-compact" id="kpiParakratisi"></div>
                <div class="kpi-card kpi-card-compact" id="kpiMDE"></div>
                <div class="kpi-card kpi-card-compact" id="kpiRebate"></div>
                <div class="kpi-card kpi-card-compact" id="kpiKrathseis"></div>
                <div class="kpi-card kpi-card-compact" id="kpiClawback"></div>
            </div>

            <!-- Recent Entries -->
            <div class="card card-compact">
                <div class="collapsible-header" onclick="handleCollapsibleClick(event, 'recentEntriesContent')">
                    <h3>Πρόσφατες Εγγραφές</h3>
                    <div class="collapsible-actions">
                        <button type="button" class="btn-secondary btn-compact btn-sm" id="exportDashboardPdfBtn" 
                                onclick="event.stopPropagation()">📄 PDF</button>
                    </div>
                    <span class="collapse-icon">▼</span>
                </div>
                <div id="recentEntriesContent" class="collapsible-content collapsed">
                    <div class="table-responsive">
                        <table class="data-table data-table-compact">
                            <thead>
                                <tr>
                                    <th>Ημ/νία</th>
                                    <th>Διαγνωστικό</th>
                                    <th>Ασφάλεια</th>
                                    <th>Τύπος</th>
                                    <th class="text-right">Τελικό Ποσό</th>
                                </tr>
                            </thead>
                            <tbody id="recentEntriesBody">
                                <tr><td colspan="5" class="text-center">Δεν υπάρχουν εγγραφές</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid charts-grid-compact">
                <div class="card card-compact">
                    <!-- Φίλτρα Γραφημάτων -->
                    <div class="chart-filters">
                        <div class="chart-filter-group">
                            <label>Πηγή:</label>
                            <select id="chartFilterSource" class="form-select form-select-compact">
                                <option value="">Όλες</option>
                            </select>
                        </div>
                        <div class="chart-filter-group">
                            <label>Ασφάλεια:</label>
                            <select id="chartFilterInsurance" class="form-select form-select-compact">
                                <option value="">Όλες</option>
                            </select>
                        </div>
                        <div class="chart-filter-group">
                            <label>Περίοδος:</label>
                            <select id="chartFilterPeriod" class="form-select form-select-compact">
                                <option value="all">Όλες</option>
                                <option value="month">Τρέχων Μήνας</option>
                                <option value="year" selected>Τρέχον Έτος</option>
                                <option value="custom">Προσαρμοσμένη</option>
                            </select>
                        </div>
                        <div class="chart-filter-group" id="customPeriodGroup" style="display: none;">
                            <input type="text" id="chartFilterDateFrom" class="form-input form-input-compact" placeholder="MM/YYYY">
                            <span>έως</span>
                            <input type="text" id="chartFilterDateTo" class="form-input form-input-compact" placeholder="MM/YYYY">
                        </div>
                        <div class="chart-filter-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="chartIncludeParakratisi">
                                <span>Με Παρακράτηση</span>
                            </label>
                        </div>
                        <button id="applyChartFilters" class="btn-primary btn-compact btn-sm">Εφαρμογή</button>
                        <button id="clearChartFilters" class="btn-secondary btn-compact btn-sm">Καθαρισμός</button>
                    </div>
                    
                    <div class="chart-header">
                        <h3>Έσοδα ανά Τύπο</h3>
                        <button type="button" class="btn-secondary btn-compact btn-sm" 
                                onclick="window.exportChartPDF('typeChart')">📄 PDF</button>
                    </div>
                    <canvas id="typeChart"></canvas>
                </div>
                <div class="card card-compact">
                    <div class="chart-header">
                        <h3>Μηνιαία Εξέλιξη</h3>
                        <button type="button" class="btn-secondary btn-compact btn-sm" 
                                onclick="window.exportChartPDF('monthlyChart')">📄 PDF</button>
                    </div>
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>

        <!-- Entries View -->
        <div id="entriesView" class="view">
            <div class="view-header">
                <h2>Εγγραφές</h2>
                <div class="view-actions">
                    <button id="importCsvBtn" class="btn-secondary btn-compact">📤 CSV</button>
                    <button id="exportCsvBtn" class="btn-secondary btn-compact">📥 CSV</button>
                    <button id="exportEntriesPdfBtn" class="btn-secondary btn-compact">📄 PDF</button>
                    <button id="addEntryBtn" class="btn-primary btn-compact">+ Νέα</button>
                </div>
            </div>

            <div class="card card-compact filters-card">
                <div class="form-row form-row-tight">
                    <div class="form-group form-group-compact">
                        <label>Από (ΜΜ/ΕΕΕΕ)</label>
                        <input type="text" id="filterDateFrom" class="form-input form-input-compact" placeholder="01/25">
                    </div>
                    <div class="form-group form-group-compact">
                        <label>Έως (ΜΜ/ΕΕΕΕ)</label>
                        <input type="text" id="filterDateTo" class="form-input form-input-compact" placeholder="12/25">
                    </div>
                    <div class="form-group form-group-compact">
                        <label>Διαγνωστικό</label>
                        <select id="filterSource" class="form-select form-select-compact">
                            <option value="">Όλα</option>
                        </select>
                    </div>
                    <div class="form-group form-group-compact">
                        <label>Ασφάλεια</label>
                        <select id="filterInsurance" class="form-select form-select-compact">
                            <option value="">Όλες</option>
                        </select>
                    </div>
                    <div class="form-group form-group-compact">
                        <label>Τύπος</label>
                        <select id="filterType" class="form-select form-select-compact">
                            <option value="">Όλοι</option>
                            <option value="cash">Μετρητά</option>
                            <option value="invoice">Τιμολόγια</option>
                        </select>
                    </div>
                    <div class="form-group form-group-compact">
                        <label>Αρχικό Ποσό Από (€)</label>
                        <input type="number" id="filterOriginalAmountFrom" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                    </div>
                    <div class="form-group form-group-compact">
                        <label>Αρχικό Ποσό Έως (€)</label>
                        <input type="number" id="filterOriginalAmountTo" class="form-input form-input-compact" step="0.01" min="0" max="9999999" placeholder="9999999">
                    </div>
                    <div class="form-group form-group-compact">
                        <label>Τελικό Ποσό Από (€)</label>
                        <input type="number" id="filterFinalAmountFrom" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                    </div>
                    <div class="form-group form-group-compact">
                        <label>Τελικό Ποσό Έως (€)</label>
                        <input type="number" id="filterFinalAmountTo" class="form-input form-input-compact" step="0.01" min="0" max="9999999" placeholder="9999999">
                    </div>
                    <div class="form-group form-group-compact">
                        <label>Κρατήσεις Από (%)</label>
                        <input type="number" id="filterDeductionPercentFrom" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                    </div>
                    <div class="form-group form-group-compact">
                        <label>Κρατήσεις Έως (%)</label>
                        <input type="number" id="filterDeductionPercentTo" class="form-input form-input-compact" step="0.01" min="0" placeholder="100">
                    </div>
                </div>
                <div class="form-actions">
                    <button id="applyFiltersBtn" class="btn-primary btn-compact">Εφαρμογή</button>
                    <button id="clearFiltersBtn" class="btn-secondary btn-compact">Καθαρισμός</button>
                </div>
            </div>

            <div class="card card-compact">
                <div class="table-responsive">
                    <table class="data-table data-table-compact">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="date">Ημ/νία <span class="sort-icon">⇅</span></th>
                                <th class="sortable" data-sort="source">Διαγνωστικό <span class="sort-icon">⇅</span></th>
                                <th class="sortable" data-sort="insurance">Ασφάλεια <span class="sort-icon">⇅</span></th>
                                <th class="sortable" data-sort="type">Τύπος <span class="sort-icon">⇅</span></th>
                                <th class="sortable text-right" data-sort="originalAmount">Αρχικό <span class="sort-icon">⇅</span></th>
                                <th class="text-right">Παρακρ.</th>
                                <th class="text-right">ΜΔΕ</th>
                                <th class="text-right">Rebate</th>
                                <th class="text-right">Κρατ.</th>
                                <th class="text-right">Clawback</th>
                                <th class="sortable text-right" data-sort="finalAmount">Τελικό <span class="sort-icon">⇅</span></th>
                                <th>Σημειώσεις</th>
                                <th>Ενέργειες</th>
                            </tr>
                        </thead>
                        <tbody id="entriesTableBody">
                            <tr><td colspan="8" class="text-center">Δεν υπάρχουν εγγραφές</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination-controls">
                    <div class="pagination-size-selector">
                        <label>Εγγραφές ανά σελίδα:</label>
                        <select id="pageSizeSelect" class="form-select form-select-compact">
                            <option value="20" selected>20</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="75">75</option>
                            <option value="100">100</option>
                            <option value="150">150</option>
                        </select>
                    </div>
                    <div class="pagination" id="pagination"></div>
                </div>
            </div>
        </div>

        <!-- Reports View -->
        <div id="reportsView" class="view">
            <h2>Αναφορές</h2>
            <div class="card card-compact">
                <p>Αναφορές - Coming soon</p>
            </div>
        </div>

        <!-- Comparison View -->
        <div id="comparisonView" class="view">
            <h2>Σύγκριση Περιόδων</h2>
            <div class="card card-compact">
                <p>Σύγκριση - Coming soon</p>
            </div>
        </div>

        <!-- Forecasting View -->
        <div id="forecastingView" class="view">
            <h2>Προβλέψεις</h2>
            <div class="card card-compact">
                <p>Προβλέψεις - Coming soon</p>
            </div>
        </div>

        <!-- Heatmaps View -->
        <div id="heatmapsView" class="view">
            <h2>Heatmaps</h2>
            <div class="card card-compact">
                <p>Heatmaps - Coming soon</p>
            </div>
        </div>

        <!-- Cloud View -->
        <div id="cloudView" class="view">
            <h2>Cloud Sync</h2>
            <div class="card card-compact">
                <p>Cloud - Coming soon</p>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settingsView" class="view">
            <h2>Ρυθμίσεις</h2>
            
            <div class="card card-compact">
                <h3>Εμφάνιση</h3>
                <div class="form-group form-group-compact">
                    <label class="checkbox-label">
                        <input type="checkbox" id="darkModeToggle">
                        <span>Σκοτεινό Θέμα</span>
                    </label>
                </div>
            </div>

            <div class="card card-compact">
                <h3>Backup</h3>
                <div class="form-actions">
                    <button id="exportBackupBtn" class="btn-primary btn-compact">💾 Export</button>
                    <button id="importBackupBtn" class="btn-secondary btn-compact">📤 Import</button>
                    <input type="file" id="backupFileInput" accept=".json" style="display: none;">
                    <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                </div>
                
                <div class="autosave-settings">
                    <label class="checkbox-label">
                        <input type="checkbox" id="autosaveEnabled">
                        <span>Αυτόματη Αποθήκευση Backup</span>
                    </label>
                    <div class="autosave-config" id="autosaveConfig" style="margin-top: 0.75rem; display: none;">
                        <div class="form-row form-row-tight">
                            <div class="form-group form-group-compact">
                                <label>Backup μετά από (αλλαγές):</label>
                                <input type="number" id="autosaveThreshold" class="form-input form-input-compact" 
                                    min="1" max="100" value="5" style="max-width: 100px;">
                            </div>
                        </div>
                        <div id="autosaveStatus" class="autosave-status"></div>
                    </div>
                </div>
            </div>

            <div class="card card-compact">
                <h3>Διαγνωστικά (Πηγές)</h3>
                <div class="sortable-list" id="sourcesList"></div>
                <div class="form-row form-row-tight">
                    <input type="text" id="newSourceInput" class="form-input form-input-compact" placeholder="Νέο διαγνωστικό">
                    <button id="addNewSourceBtn" class="btn-add btn-compact">Προσθήκη</button>
                </div>
            </div>

            <div class="card card-compact">
                <h3>Ασφάλειες</h3>
                <div class="sortable-list" id="insurancesList"></div>
                <div class="form-row form-row-tight">
                    <input type="text" id="newInsuranceInput" class="form-input form-input-compact" placeholder="Νέα ασφάλεια">
                    <button id="addNewInsuranceBtn" class="btn-add btn-compact">Προσθήκη</button>
                </div>
            </div>

            <!-- Danger Zone at the end -->
            <div class="card card-compact danger-zone-card">
                <h3 style="color: var(--danger-color);">⚠️ Επικίνδυνη Ζώνη</h3>
                <div style="background-color: #fef2f2; border: 2px solid #ef4444; padding: 0.75rem; border-radius: 6px; margin-bottom: 0.75rem;">
                    <p style="color: #991b1b; margin-bottom: 0.25rem; font-size: 0.9rem;"><strong>ΠΡΟΣΟΧΗ:</strong> Διαγραφή όλων των δεδομένων!</p>
                    <small style="color: #b91c1c; font-size: 0.85rem;">Δημιουργήστε backup πριν προχωρήσετε.</small>
                </div>
                <button id="clearCacheBtn" class="btn-danger btn-compact">🗑️ Καθαρισμός Όλων</button>
                <div id="clearCacheReport" class="cache-report"></div>
            </div>
        </div>
    </main>

    <!-- Entry Modal -->
    <div id="entryModal" class="modal">
        <div class="modal-content modal-compact">
            <div class="modal-header">
                <h3 id="modalTitle">Νέα Εγγραφή</h3>
                <button class="modal-close" onclick="document.getElementById('entryModal').classList.remove('active')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="entryId">
                <div class="form-row form-row-tight">
                    <div class="form-group form-group-compact">
                        <label>Ημερομηνία*</label>
                        <input type="text" id="entryDate" class="form-input form-input-compact" required>
                    </div>
                    <div class="form-group form-group-compact">
                        <label>Διαγνωστικό*</label>
                        <select id="entrySource" class="form-select form-select-compact" required>
                            <option value="">Επιλογή...</option>
                        </select>
                    </div>
                    <div class="form-group form-group-compact">
                        <label>Ασφάλεια*</label>
                        <select id="entryInsurance" class="form-select form-select-compact" required>
                            <option value="">Επιλογή...</option>
                        </select>
                    </div>
                    <div class="form-group form-group-compact">
                        <label>Τύπος*</label>
                        <select id="entryType" class="form-select form-select-compact" required>
                            <option value="cash">Μετρητά</option>
                            <option value="invoice">Τιμολόγια</option>
                        </select>
                    </div>
                    <div class="form-group form-group-compact">
                        <label>Ποσό (€)*</label>
                        <input type="number" id="entryAmount" class="form-input form-input-compact" step="0.01" min="0" required>
                    </div>
                </div>
                
                <div id="modalEopyyDeductions" class="retention-fields retention-compact" style="display: none;">
                    <h4>Κρατήσεις ΕΟΠΥΥ</h4>
                    <div class="form-row form-row-tight">
                        <div class="form-group form-group-compact">
                            <label>Παρακράτηση €</label>
                            <input type="number" id="entryParakratisi" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                        </div>
                        <div class="form-group form-group-compact">
                            <label>Παρακράτηση %</label>
                            <input type="number" id="entryParakratisiPercent" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                        </div>
                        <div class="form-group form-group-compact">
                            <label>ΜΔΕ €</label>
                            <input type="number" id="entryMDE" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                        </div>
                        <div class="form-group form-group-compact">
                            <label>ΜΔΕ %</label>
                            <input type="number" id="entryMDEPercent" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                        </div>
                    </div>
                    <div class="form-row form-row-tight">
                        <div class="form-group form-group-compact">
                            <label>Rebate €</label>
                            <input type="number" id="entryRebate" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                        </div>
                        <div class="form-group form-group-compact">
                            <label>Rebate %</label>
                            <input type="number" id="entryRebatePercent" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                        </div>
                        <div class="form-group form-group-compact">
                            <label>Κρατήσεις €</label>
                            <input type="number" id="entryKrathseisEopyy" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                        </div>
                        <div class="form-group form-group-compact">
                            <label>Κρατήσεις %</label>
                            <input type="number" id="entryKrathseisEopyyPercent" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                        </div>
                    </div>
                    <div class="form-row form-row-tight">
                        <div class="form-group form-group-compact">
                            <label>Clawback €</label>
                            <input type="number" id="entryClawback" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                        </div>
                        <div class="form-group form-group-compact">
                            <label>Clawback %</label>
                            <input type="number" id="entryClawbackPercent" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                        </div>
                    </div>
                </div>

                <div id="modalNonEopyyDeductions" class="retention-fields retention-compact" style="display: none;">
                    <h4>Κρατήσεις</h4>
                    <div class="form-row form-row-tight">
                        <div class="form-group form-group-compact">
                            <label>Κρατήσεις €</label>
                            <input type="number" id="entryKrathseisOther" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                        </div>
                        <div class="form-group form-group-compact">
                            <label>Κρατήσεις %</label>
                            <input type="number" id="entryKrathseisOtherPercent" class="form-input form-input-compact" step="0.01" min="0" placeholder="0">
                        </div>
                    </div>
                </div>

                <div class="final-amount-display">
                    <strong>Τελικό Ποσό: <span id="modalFinalAmount">€ 0,00</span></strong>
                </div>

                <div class="form-group form-group-compact">
                    <label class="checkbox-label">
                        <input type="checkbox" id="entryNotesToggle">
                        <span>Προσθήκη Σημειώσεων</span>
                    </label>
                    <textarea id="entryNotes" class="form-textarea form-textarea-compact" rows="2" style="display: none;"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary btn-compact" onclick="document.getElementById('entryModal').classList.remove('active')">Άκυρο</button>
                <button class="btn-primary btn-compact" onclick="window.saveEntry()">Αποθήκευση</button>
            </div>
        </div>
    </div>

    <!-- Import Backup Modal -->
    <div id="importBackupModal" class="modal">
        <div class="modal-content modal-large modal-compact">
            <div class="modal-header">
                <h3>Import Backup</h3>
                <button class="modal-close" onclick="document.getElementById('importBackupModal').classList.remove('active')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="import-mode-selection">
                    <h4>Επιλέξτε Μέθοδο</h4>
                    <div class="radio-group">
                        <label class="radio-label radio-label-compact">
                            <input type="radio" name="importMode" value="merge" checked>
                            <div class="radio-content">
                                <strong>Merge</strong>
                                <small>Προσθήκη νέων, ενημέρωση υπαρχόντων</small>
                            </div>
                        </label>
                        <label class="radio-label radio-label-compact">
                            <input type="radio" name="importMode" value="overwrite">
                            <div class="radio-content">
                                <strong>Overwrite</strong>
                                <small>Διαγραφή όλων και εισαγωγή από backup</small>
                            </div>
                        </label>
                    </div>
                </div>

                <div id="importPreview" style="display: none;">
                    <h4>Preview</h4>
                    <div class="import-preview-info">
                        <div class="preview-section" id="backupInfo"></div>
                        <div class="preview-section" id="impactInfo"></div>
                    </div>
                </div>

                <div id="importReport" style="display: none;">
                    <h4>Αποτελέσματα</h4>
                    <div class="import-report-content"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary btn-compact" onclick="document.getElementById('importBackupModal').classList.remove('active')">Κλείσιμο</button>
                <button id="confirmImportBtn" class="btn-primary btn-compact">Επιβεβαίωση</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast toast-compact"></div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('SW registered:', reg.scope))
                    .catch(err => console.error('SW registration failed:', err));
            });
        }
    </script>

    <script type="module" src="./app.js"></script>
</body>
</html>